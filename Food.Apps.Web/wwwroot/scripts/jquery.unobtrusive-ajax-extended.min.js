/*!
** Unobtrusive Ajax support library for jQuery
** Copyright (C) Microsoft Corporation. All rights reserved.
*/
(function(n){function r(n,t){for(var i=window,r=(n||"").split(".");i&&r.length;)i=i[r.shift()];return typeof i=="function"?i:(t.push(n),Function.constructor.apply(null,t))}function f(n){return n==="GET"||n==="POST"}function o(n,t){f(t)||n.setRequestHeader("X-HTTP-Method-Override",t)}function s(t,i,r){var u;r.indexOf("application/x-javascript")===-1&&(u=(t.getAttribute("data-ajax-mode")||"").toUpperCase(),n(t.getAttribute("data-ajax-update")).each(function(t,r){var f;switch(u){case"BEFORE":f=r.firstChild;n("<div />").html(i).contents().each(function(){r.insertBefore(this,f)});break;case"AFTER":n("<div />").html(i).contents().each(function(){r.appendChild(this)});break;case"REPLACE-WITH":n(r).replaceWith(i);break;default:n(r).html(i)}}))}function i(t,i){var e,h,u,c;(e=t.getAttribute("data-ajax-confirm"),!e||window.confirm(e))&&(h=n(t.getAttribute("data-ajax-loading")),c=parseInt(t.getAttribute("data-ajax-loading-duration"),10)||0,n.extend(i,{type:t.getAttribute("data-ajax-method")||undefined,url:t.getAttribute("data-ajax-url")||undefined,cache:!!t.getAttribute("data-ajax-cache"),beforeSend:function(n){var i;return o(n,u),i=r(t.getAttribute("data-ajax-begin"),["xhr"]).apply(t,arguments),i!==!1&&h.show(c),i},complete:function(){h.hide(c);r(t.getAttribute("data-ajax-complete"),["xhr","status"]).apply(t,arguments)},success:function(n,i,u){s(t,n,u.getResponseHeader("Content-Type")||"text/html");r(t.getAttribute("data-ajax-success"),["data","status","xhr"]).apply(t,arguments)},error:function(){r(t.getAttribute("data-ajax-failure"),["xhr","status","error"]).apply(t,arguments)}}),Array.isArray(i.data)&&i.data.push({name:"X-Requested-With",value:"XMLHttpRequest"}),u=i.type.toUpperCase(),f(u)||(i.type="POST",i.data.push({name:"X-HTTP-Method-Override",value:u})),n.ajax(i))}function h(t){var i=n(t).data(e);return!i||!i.validate||i.validate()}var t="unobtrusiveAjaxClick",u="unobtrusiveAjaxClickTarget",e="unobtrusiveValidation";n(document).on("click","a[data-ajax=true]",function(n){n.preventDefault();i(this,{url:this.href,type:"GET",data:[]})});n(document).on("click","form[data-ajax=true] input[type=image]",function(i){var r=i.target.name,u=n(i.target),f=n(u.parents("form")[0]),e=u.offset();f.data(t,[{name:r+".x",value:Math.round(i.pageX-e.left)},{name:r+".y",value:Math.round(i.pageY-e.top)}]);setTimeout(function(){f.removeData(t)},0)});n(document).on("click","form[data-ajax=true] :submit",function(i){var f=i.currentTarget.name,e=n(i.target),r=n(e.parents("form")[0]);r.data(t,f?[{name:f,value:i.currentTarget.value}]:[]);r.data(u,e);setTimeout(function(){r.removeData(t);r.removeData(u)},0)});n(document).on("submit","form[data-ajax=true]",function(r){var e=n(this).data(t)||[],f=n(this).data(u),o=f&&f.hasClass("cancel");(r.preventDefault(),o||h(this))&&i(this,{url:this.action,type:this.method||"GET",data:e.concat(n(this).serializeArray())})});n(document).on("change","input[type=file][data-ajax=true]",function(n){var r,u,f,t;if(n.preventDefault(),r=n.target.files,r.length>0)if(window.FormData!==undefined){for(u=new FormData,f=!0,t=0;t<r.length;t++)r[t].size>2097152?(f=!1,alert("Размер файла слишком большой")):u.append("file"+t,r[t]);f&&i(this,{contentType:!1,processData:!1,data:u})}else console.log("This browser doesn't support HTML5 file uploads!")});n(document).on("change","input[type=text][data-ajax=true]",function(n){n.preventDefault();var t=[];t.push({name:this.name,value:this.value});i(this,{type:"GET",data:t})});n(document).on("change","textarea[data-ajax=true]",function(n){n.preventDefault();var t=[];t.push({name:this.name,value:this.value});i(this,{type:"GET",data:t})})})(jQuery);