function eventHandlers(){$("#menu-patterns #PatternName").on("input",function(){var n=$(this).val();n!==""?($("#add-pattern-btn").removeAttr("disabled"),$("#IsBanket").removeAttr("disabled")):($("#add-pattern-btn").attr("disabled",!0),$("#IsBanket").attr("disabled",!0))});$("#menu-patterns select").on("change",function(){var t=$(this).data("url"),i=$(this).data("target"),n=$(this).val();$.ajax({type:"POST",url:t,data:{id:n},success:function(t){$(i).html(t);n!==""?($("#update-menu-form").find("button").removeAttr("disabled"),$("#manager-menu").attr("data-preview",!0),$("#del-pattern-btn").removeAttr("disabled"),$("#add-pattern-btn").removeAttr("disabled"),$("#cancel-pattern-btn").removeAttr("disabled"),$("#IsBanket").removeAttr("disabled")):($("#manager-menu").attr("data-preview",!1),$("#update-menu-form").find("button").attr("disabled","disabled"),$("#del-pattern-btn").attr("disabled",!0),$("#add-pattern-btn").attr("disabled",!0),$("#cancel-pattern-btn").attr("disabled",!0),$("#IsBanket").attr("disabled",!0));$("#save-menu-form").find("#PatternName").val($("#select-pattern-form").find("option:selected").text());eventHandlers()}})})}function getDocumentHandler(){$(document).ready(function(){$(".selectable").selectable({filter:".selectable-item",cancel:"span,.cancel-select,a"});$(".document-type").on("click",function(n){var i=$(this),t;n.preventDefault();t=i.closest("form").serializeArray();$(".selectable .ui-selected").each(function(){t.push({name:$(this).data("name"),value:$(this).data("item-id")})});t.push({name:"X-Requested-With",value:"XMLHttpRequest"});$.ajax({type:"POST",url:i.attr("href"),data:t,success:function(n){var r=i.attr("target"),t;r?(t=window.open(n,r),$(t).ready(function(){setTimeout(function(){t.print()},1e3)})):window.location=n}})});$("[name=SortType]").change(function(){$("#form0").submit()})}).keypress(function(n){n.keyCode===27&&$(".selectable .ui-selected").removeClass("ui-selected")});$(".expand-order").on("click",function(){var n=$(this),u=n.attr("data-load");if(u){var t=n.parent().parent().data("item-id"),f=$("[name=SortType][checked]").val(),r="/manager/reports/userorders?companyorderId="+t+"&SortType="+f,i=n.data("target");t||(t=n.parent().parent().data("banket-id"),r="/manager/reports/banketorders?banketId="+t,i=i+" td");$.ajax({url:r,success:function(t){$(i).html(t);n.removeAttr("data-load")}})}})}function expandOrderItems(n){$(n).on("click",".expand-order-items",function(){var n=$(this),i=n.attr("data-load"),t;i&&(t=n.parent().parent().data("item-id"),$.ajax({url:"/manager/reports/orderitems?orderid="+t,success:function(i){$("#order-positions-"+t).html(i);n.removeAttr("data-load")}}))})}function saveMenu(n){var t=$("#save-menu-form"),i=$("#schedule-dishes").find("form").serialize();if(t.valid()&&i.length>0){var u=$(t).attr("action"),f=$(t).serialize(),r=!1;n&&(r=!0);$.ajax({type:"POST",url:u+"?"+f+"&approve="+r,async:!1,processData:!1,traditional:!0,data:i,success:function(i){$($(t).data("ajax-update")).replaceWith(i);eventHandlers();n&&$("#approveModal").modal("hide")},error:function(){$("#approveModal").modal("show")}})}}function updateMenuByPtternId(n){var i=$("#menu-patterns #PatternId").val(),t;i!==""&&(t=$(n).closest("form"),t.find("#PatternId",i),t.submit())}function move(n,t,i,r){var l=i.data("category"),o=".panel[data-category="+l+"]",a=$(n),s=a.children(o),h=$(t),u=h.children(o),f=null,c,e;u[0]||(h.append(s.clone(!0,!0)),u=h.children(o),c=u.find("a[data-toggle=collapse]"),e=c.attr("data-target"),e=e.replace(n,t),c.attr("data-target",e),f=u.find("> ul"),f.empty());f=u.find("ul");f.append(i);i.data("category",l);r===0?$(i).find(".add-action").replaceWith($("#remove-action").html()):$(i).find(".remove-action").replaceWith($("#add-action").html());s.find("ul").children().length===0&&s.remove()}function removeDeliveryCostItem(n){$("#Delivery-cost-"+n).remove()}function editDeliveryCostItem(n){$("#Delivery-cost-"+n+" input").prop("readonly",!1);$("#Delivery-cost-"+n+" input[name*=IsEdit]").attr("value",!0)}function removeDish(n){var t=$("#remove-cat-id").val();$("#dish-"+n).detach().appendTo(t)}function updateIndexInCategory(n){$("[data-category = "+n+"]").children("ul").children("li").each(function(){$(this).data("dish-index",$(this).index()-1)})}function managerMenu(){$(document).ready(function(){$("#manager-dishes .sortable").sortable({connectWith:".sortable",containment:".main",items:".sortable-item",cursor:"move",sort:function(n,t){t.helper.css({top:t.position.top+$("html").scrollTop()+"px"})},update:function(n,t){if(!t.sender){var r=$(this),e=r.data("category"),o=t.item.index(),i=t.item.data("dish-index");i===""&&(i=-1);var s=t.item.attr("id").substr(5),u=0,f=$("#active-categories").data("change-dish-url");$(this).data("category")!==t.item.closest("div").data("category")&&(f=$("#active-categories").data("update-dish-index-url"),u=t.item.closest("div").data("category"));$.ajax({type:"POST",url:f,traditional:!0,async:!1,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{newCategoryId:u,oldCategoryId:e,newIndex:o,oldIndex:i,dishId:s},success:function(){r.children("ul").children("li").each(function(){$(this).data("dish-index",$(this).index())})},error:function(){$(this).sortable("cancel")}})}},receive:function(n,t){var i=$(this),r=$(this).data("category"),u=t.item.index(),f=$("#active-categories").data("add-dish-url"),o=t.item.data("dish-index"),e=t.item.attr("id").substr(5);$.ajax({type:"POST",url:f,traditional:!0,async:!1,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{categoryId:r,newIndex:u,dishId:e},success:function(){i.children("ul").children("li").each(function(){$(this).data("dish-index",$(this).index())})},error:function(){$(this).sortable("cancel")}})}});$("#manager-dishes .sortable-panels").sortable({connectWith:".sortable-panels",containment:".main",items:".panel",cursor:"move",handle:".panel-heading",sort:function(n,t){t.helper.css({top:t.position.top+$("html").scrollTop()+"px"})},update:function(n,t){var i,r;if(!t.sender&&(i=$(this),i[0]===t.item.closest(".sortable-panels")[0])&&(r=i.data("change-url"),r)){var u=t.item.index(),f=t.item.data("index"),e=t.item.data("category"),o=u-f;$.ajax({type:"POST",url:r,traditional:!0,async:!1,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{categoryId:e,offset:o},success:function(){$(".card-content").first().children(".panel").each(function(){$(this).data("index",$(this).index())})},error:function(){i.sortable("cancel")}})}},receive:function(n,t){var i=$(this),r=i.data("add-url")||i.data("remove-url"),u,f;r&&(u=t.item.prev().data("source-index"),f=u+10||10,$.ajax({type:"POST",url:r,traditional:!0,async:!1,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:{categoryId:t.item.data("category"),offset:f},success:function(){$("#active-categories").find(".panel").each(function(){$(this).data("index",$(this).index());$(this).data("source-index",10+$(this).index()*10)});$("#inactive-categories").find(".panel").each(function(){$(this).data("index",-1)})},error:function(){i.sortable("cancel")}}))}})})}function managerHistory(){$(document).ready(function(){$(document).on("click",".category-anchors-manager a",function(n){n.preventDefault();var i=$(this).attr("href"),t=$(i).find(".collapse"),r=t.attr("aria-expanded");r==="false"&&$(t).collapse("show");$("html, body").animate({scrollTop:t.offset().top-t.prev().outerHeight(!0)-100},500)})})}function prepareFormData(n,t,i,r){var u,f,e,s,o;return n.find("#ActionType").length>0?n.find("#ActionType").val(t):(u=document.createElement("input"),u.id="ActionType",u.type="hidden",u.value=t,u.name="ActionType",n.append(u.outerHTML)),n.find("#ToDate").length>0?n.find("#ToDate").val(r):(f=document.createElement("input"),f.id="ToDate",f.type="hidden",f.value=r,f.name="ToDate",n.append(f.outerHTML)),n.find("#IsPreview").length>0?n.find("#IsPreview").val(i):(e=document.createElement("input"),e.id="IsPreview",e.type="hidden",e.value=i,e.name="IsPreview",n.append(e.outerHTML)),s=n.closest("li").data("category"),o=document.createElement("input"),o.id="CategoryId",o.type="hidden",o.value=s,o.name="CategoryId",n.append(o.outerHTML),n}function addListeners(n){var t=document;n&&(t=n);$(t).on("submit",".menu-dish",function(n){return n.preventDefault(),!1});$(t).on("click",".add-action",function(){addToMenu(this)});$(t).on("click",".remove-action",function(){removeFromMenu(this)});$(t).on("input",".price input",function(){changePrice(this)})}function addToMenu(n){var t=$("#manager-menu").data("preview"),i=prepareFormData($(n).closest("form"),0,t,$("#datepicker input").val());t||handleMenuForm(i);move("#available-dishes","#schedule-dishes",i.parent(),0)}function removeFromMenu(n){var t=$("#manager-menu").data("preview"),i=prepareFormData($(n).closest("form"),1,t,$("#datepicker input").val());t||handleMenuForm(i);move("#schedule-dishes","#available-dishes",i.parent(),1)}function changePrice(n){var i=$("#manager-menu").data("preview"),t=$(n).parent().children("span");if(t.html()!='<i class="fa fa-floppy-o"><\/i>'){t.html('<i class="fa fa-floppy-o"/>');t.on("click",function(){var n=prepareFormData($(this).closest("form"),2,i,$("#datepicker input").val());handleMenuForm(n)})}}function handleMenuForm(n){var i=$(n).attr("action"),t=$("#processIcon");$.ajax({url:i,type:"POST",data:$(n).serialize(),beforeSend:function(){t.show()},success:function(t){$(n.parent()).replaceWith(t);addListeners($.parseHTML(t)[1])},complete:function(){t.hide()}})}function changeDirectionArrow(n){$(n).hasClass("collapsed")?$(n).removeClass("collapsed"):$(n).addClass("collapsed")}function changeDirectionAllArrow(n,t,i){$(n).attr("state")==0?$(t+" "+i).removeClass("collapsed"):$(t+" "+i).addClass("collapsed")}function ajaxChangeStatusOrdersInCompany(n,t){var i=$(n).closest("table").children("tbody");$.each(i,function(n,i){t+="&orderIds="+$(i).data("order-id")});$.ajax({url:t,method:"GET",success:function(t){i.remove();$(n).closest("table").append(t)}})}